{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "$id": "https://github.com/infn-epics/ibek-templates/releases/download/v1/scandinova-rfmod.schema.json",
  "allOf": [
    {
      "$ref": "../../schemas/ioc.schema.json"
    }
  ],
  "properties": {
    "template": {
      "const": "scandinova-rfmod",
      "description": "The template type for Scandinova RF Modulator lite startup."
    },
    "devtype": {
      "const": "scandinova-rfmod",
      "description": "Device type name used by the IBEK support module."
    },
    "devgroup": {
      "const": "modulator",
      "description": "Device group classification."
    },
    "version": {
      "type": "string",
      "description": "IOC version string for iocAdmin."
    },
    "server": {
      "type": "string",
      "description": "Default IP address for devices (can be overridden per device).",
      "default": "127.0.0.1"
    },
    "port": {
      "type": "integer",
      "description": "Default Modbus TCP port (can be overridden per device).",
      "default": 502
    },
    "POLLING": {
      "type": "integer",
      "description": "Default standard polling interval (ms)",
      "default": 2000
    },
    "WD_POLLING": {
      "type": "integer",
      "description": "Default watchdog read polling (ms)",
      "default": 1000
    },
    "WD_WRITE_POLLING": {
      "type": "integer",
      "description": "Default watchdog write polling (ms)",
      "default": 800
    },
    "devices": {
      "type": "array",
      "description": "Array of Scandinova RF Modulator devices to configure.",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string", "description": "Identifier for the device (e.g. 'MOD01')" },
          "server": { "type": "string", "description": "IP address or hostname for this device" },
          "SLAVE_ADDR": { "type": "integer", "description": "Modbus slave address", "default": 1 },
          "port": { "type": "integer", "description": "Modbus TCP port for this device", "default": 502 },
          "polling": { "type": "integer", "description": "Polling interval (ms) for this device" },
          "wd_polling": { "type": "integer", "description": "Watchdog read polling (ms)" },
          "wd_write_polling": { "type": "integer", "description": "Watchdog write polling (ms)" },
          "v_max": { "type": "integer", "description": "CCPS voltage setpoint high operating range" },
          "pls_width_max": { "type": "integer", "description": "Pulse width setpoint high operating range" },
          "i_max": { "type": "integer", "description": "Filament current setpoint high operating range" },
          "pres_warn": { "type": "integer", "description": "Ion pump HIGH alarm threshold" },
          "pres_alarm": { "type": "integer", "description": "Ion pump HIHI alarm threshold" },
          "aliases": {
            "type": "array",
            "description": "List of aliases for this device",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string", "description": "PV name suffix" },
                "alias": { "type": "string", "description": "Alias name" }
              },
              "required": ["name", "alias"]
            }
          },
          "iocinit": {
            "type": "array",
            "description": "List of initial setpoints for this device",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string", "description": "PV name suffix" },
                "value": { "type": ["string", "number"], "description": "Initial value" }
              },
              "required": ["name", "value"]
            }
          }
        },
        "required": ["name"]
      },
      "minItems": 1
    }
  },
  "required": ["iocprefix", "template", "devices"]
}
